require('./common/vendor.js');(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["chat/chat"],{388:function(t,e,n){"use strict";(function(t){n(5);s(n(3));var e=s(n(389));function s(t){return t&&t.__esModule?t:{default:t}}wx.__webpack_require_UNI_MP_PLUGIN__=n,t(e.default)}).call(this,n(1)["createPage"])},389:function(t,e,n){"use strict";n.r(e);var s=n(390),i=n(392);for(var o in i)"default"!==o&&function(t){n.d(e,t,(function(){return i[t]}))}(o);n(394);var a,r=n(11),c=Object(r["default"])(i["default"],s["render"],s["staticRenderFns"],!1,null,"60a4fe91",null,!1,s["components"],a);c.options.__file="chat/chat.vue",e["default"]=c.exports},390:function(t,e,n){"use strict";n.r(e);var s=n(391);n.d(e,"render",(function(){return s["render"]})),n.d(e,"staticRenderFns",(function(){return s["staticRenderFns"]})),n.d(e,"recyclableRender",(function(){return s["recyclableRender"]})),n.d(e,"components",(function(){return s["components"]}))},391:function(t,e,n){"use strict";n.r(e),n.d(e,"render",(function(){return o})),n.d(e,"staticRenderFns",(function(){return a})),n.d(e,"recyclableRender",(function(){return s})),n.d(e,"components",(function(){return i}));var s,i,o=function(){},a=[]},392:function(t,e,n){"use strict";n.r(e);var s=n(393),i=n.n(s);for(var o in s)"default"!==o&&function(t){n.d(e,t,(function(){return s[t]}))}(o);e["default"]=i.a},393:function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s=o(n(125)),i=o(n(385));function o(t){return t&&t.__esModule?t:{default:t}}function a(t,e,n,s,i,o,a){try{var r=t[o](a),c=r.value}catch(u){return void n(u)}r.done?e(c):Promise.resolve(c).then(s,i)}function r(t){return function(){var e=this,n=arguments;return new Promise((function(s,i){var o=t.apply(e,n);function r(t){a(o,s,i,r,c,"next",t)}function c(t){a(o,s,i,r,c,"throw",t)}r(void 0)}))}}var c={data:function(){return{baseFileUrl:this.$baseFileUrl,userId:"",content:"",flushCnt:0,msgList:[],serviceMsgId:-1,scrollHeight:100,scrollIntoView:"",mode:0,loadMore:!0}},onLoad:function(e){var n=this;return r(s.default.mark((function i(){return s.default.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return s.next=2,n.$onLaunched;case 2:n.userId=e.id,e.name&&t.setNavigationBarTitle({title:e.name}),t.$on("user-msg-update",(function(t){n.flushData()})),getApp().globalData.g_chat.setCurChatUserId(n.userId),getApp().globalData.g_chat.updateUserMsg(n.userId);case 7:case"end":return s.stop()}}),i)})))()},onShow:function(){getApp().globalData.g_chat&&getApp().globalData.g_chat.updateUserMsg(this.userId)},onReady:function(){this.hidePageNavInWechatBrowser(),this.calcHeight()},methods:{sendMsg:function(t,e){getApp().globalData.g_chat&&(getApp().globalData.g_chat.sendMsgToUserCmd(this.userId,t,e),this.content="",this.changeMode(0))},flushData:function(){if(getApp().globalData.g_chat){var t=getApp().globalData.g_chat.findUser(this.userId);if(t>-1){var e=0;this.msgList.length>0&&(this.msgList[0].id,e=this.msgList[this.msgList.length-1].id),this.msgList=[],this.msgPicList=[];for(var n={},s=getApp().globalData.g_chat.getUserList(),i=0;i<s[t].msgList.length;++i)n=s[t].msgList[i],1==n.contentType?(n.contentPic=this.baseFileUrl+"/file/"+n.contentText,this.msgPicList.push(n.contentPic)):(n.contentTexts=this.getHref(n.contentText),this.msgList.push(n)),this.msgList[i].showTime=this.getMsgTime(i);if(this.msgList.length>0){this.msgList[0].id;var o=this.msgList[this.msgList.length-1].id;e!=o&&this.scrollToMsg(),this.msgList[0].isLastHistory?this.loadMore=!1:this.loadMore=!0}else this.loadMore=!1}this.flushCnt++}},getMsgTime:function(t){var e=0,n=i.default.ISO8601DateStr2Date(this.msgList[t].time);t>0&&(e=i.default.ISO8601DateStr2Date(this.msgList[t-1].time));var s=i.default.getChatTime(n,e);return s},scrollToMsg:function(){var t=this;setTimeout((function(){t.scrollIntoView="msg_"+(t.msgList.length-1)}),200)},loadMoreMsg:function(){getApp().globalData.g_chat&&getApp().globalData.g_chat.getMsgHistoryCmd(this.userId,!0)},calcHeight:function(){var e=this;t.getSystemInfo({success:function(n){var s=n.windowHeight,i=0,o=t.createSelectorQuery().select(".msgLst");o.boundingClientRect((function(t){i=t.top})).exec();var a=t.createSelectorQuery().select(".send");a.boundingClientRect((function(t){e.scrollHeight=s-i-t.height})).exec(),console.log(e.scrollHeight)}})},isSelf:function(t){return getApp().globalData.g_chat.isSelf(t)},getUserHead:function(t){var e="";if(getApp().globalData.g_chat.isSelf(t))e=getApp().globalData.userInfo.userHeadPic;else for(var n=getApp().globalData.g_chat.getUserList(),s=0;s<n.length;++s)if(n[s].userId==t){e=n[s].head_pic;break}return e?this.$baseFileUrl+"/file/"+e:"http://bzbb.com/other/img/toptimeclub.png"},changeMode:function(e){0==e?1==this.mode&&(this.mode=0,this.scrollHeight+=t.upx2px(300)):0==this.mode?(this.mode=1,this.scrollHeight-=t.upx2px(300)):(this.mode=0,this.scrollHeight+=t.upx2px(300))},actionMode:function(e){var n=this;0==e?t.chooseImage({count:9,sourceType:["album"],success:function(t){console.log("图片选择成功",t),n.sendpic(t)}}):1==e&&t.chooseImage({count:9,sourceType:["camera"],success:function(t){n.sendpic(t)}})},sendpic:function(e){for(var n=this,s=e.tempFilePaths,i=[],o=function(e){i.push(new Promise((function(i,o){console.log("上传项",s[e]),t.uploadFile({url:n.$baseFileUrl+"/upload",fileType:"image",filePath:s[e],name:"upload-images",success:function(e){if(console.log("上传成功",e),200===e.statusCode){console.log("图片信息",e.data);var s=e.data.split("|")[0];n.sendMsg(s,1)}else console.log()("failt to upload image:",e),t.showToast({title:"图片上传失败",icon:"none",duration:2e3})},fail:function(e){console.log("failt to upload image:",e),t.showToast({title:"网络连接失败",icon:"none",duration:2e3})}})})))},a=0;a<s.length;a++)o(a)},previewImage:function(e){t.previewImage({current:e,urls:this.msgPicList,indicator:"default"})},copyItem:function(e){t.setClipboardData({data:e,success:function(){t.showToast({title:"复制成功",icon:"none"})}})},getHref:function(t){if(!t)return[];var e=/(https?:\/\/|www\.)[a-zA-Z_0-9\-@]+(\.\w[a-zA-Z_0-9\-:]+)+(\/[\(\)~#&\-=?\+\%/\.\w]+)?/g;t=t.replace(e,(function(t){return"b6b675fZ-fc22-4947-b0e2-887adX93d23e"+t+"b6b675fZ-fc22-4947-b0e2-887adX93d23e"})),t=t.split("b6b675fZ-fc22-4947-b0e2-887adX93d23e");for(var n=[],s=0;s<t.length;++s)if(t[s].length>0)if(-1==t[s].search(e))n.push({isUrl:!1,text:t[s]});else{var i=t[s];-1==i.indexOf("http")&&(i="http://"+i),n.push({isUrl:!0,text:t[s],url:i})}return n}}};e.default=c}).call(this,n(1)["default"])},394:function(t,e,n){"use strict";n.r(e);var s=n(395),i=n.n(s);for(var o in s)"default"!==o&&function(t){n.d(e,t,(function(){return s[t]}))}(o);e["default"]=i.a},395:function(t,e,n){}},[[388,"common/runtime","common/vendor","chat/common/vendor"]]]);
//# sourceMappingURL=../../.sourcemap/mp-weixin/chat/chat.js.map